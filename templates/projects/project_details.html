{% extends 'base.html' %}

{% block title %}
{{ project.name }} â€” Project Details
{% endblock %}

{% block content %}
<div
  class="container"
  style="max-width: 1000px; margin-top: 40px; margin-bottom: 60px"
>
  <!-- Header -->
  <div
    style="
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 32px;
      flex-wrap: wrap;
      gap: 20px;
    "
  >
    <div
      style="
        display: flex;
        align-items: center;
        gap: 20px;
        flex: 1;
        min-width: 0;
      "
    >
      <img
        src="{{ project.logo.url|default:'https://via.placeholder.com/80' }}"
        alt="{{ project.name }}"
        style="
          width: 80px;
          height: 80px;
          object-fit: cover;
          border-radius: 16px;
          flex-shrink: 0;
        "
      />
      <div style="min-width: 0">
        <h1 class="text-title-1" style="margin-bottom: 8px">
          {{ project.name }}
        </h1>
        <p class="text-callout" style="color: var(--color-gray); margin: 0">
          {{ project.description }}
        </p>
      </div>
    </div>
    {% if not project.is_verified %}
    <span class="badge bg-warning" style="padding: 8px 16px; font-size: 13px">
      <i class="fas fa-clock"></i>
      Pending Verification
    </span>
    {% else %}
    <span class="badge bg-success" style="padding: 8px 16px; font-size: 13px">
      <i class="fas fa-check"></i>
      Verified
    </span>
    {% endif %}
  </div>

  <!-- Implementation Details -->
  <div class="card" style="margin-bottom: 20px">
    <div
      class="card-header"
      style="display: flex; justify-content: space-between; align-items: center"
    >
      <span>
        <i class="fas fa-code" style="margin-right: 8px"></i>
        Implementation Details
      </span>
      <button
        class="btn btn-secondary"
        onclick="copyProjectId()"
        style="padding: 8px 16px; font-size: 15px"
      >
        <i class="fas fa-copy" style="margin-right: 6px"></i>
        Copy ID
      </button>
    </div>
    <div class="card-body">
      <div style="margin-bottom: 24px">
        <label class="form-label" style="margin-bottom: 8px">Project ID</label>
        <div style="display: flex; gap: 8px">
          <input
            type="text"
            class="form-control"
            id="projectId"
            value="{{ project.id }}"
            readonly
            style="
              font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
              font-size: 14px;
              flex: 1;
            "
          />
          <button
            class="btn btn-secondary"
            onclick="copyProjectId()"
            style="flex-shrink: 0"
          >
            <i class="fas fa-copy"></i>
          </button>
        </div>
        <small
          class="text-footnote"
          style="color: var(--color-gray); margin-top: 8px; display: block"
        >
          Use this ID to implement SSO in your application
        </small>
      </div>

      <div>
        <h4 class="text-headline" style="margin-bottom: 12px">
          Implementation Example
        </h4>
        <pre
          style="
            background: var(--color-charcoal);
            color: #e5e5ea;
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.6;
            margin: 0;
          "
        ><code>// SSO Login URL
GET {{ request.scheme }}://{{ request.get_host }}/project/{{ project.id }}/ssocall/

// Verify User Data
POST {{ request.scheme }}://{{ request.get_host }}/project/getuserdata
Content-Type: application/json

{
    "sessionkey": "your_session_key"
}</code></pre>
      </div>

      <div class="alert alert-info" style="margin-top: 20px; margin-bottom: 0">
        <div style="display: flex; align-items: flex-start; gap: 12px">
          <i
            class="fas fa-info-circle"
            style="font-size: 16px; margin-top: 2px"
          ></i>
          <div>
            <p
              class="text-callout"
              style="margin: 0; line-height: 1.6; color: #0056cc"
            >
              Check our
              <a
                href="{% url 'docs' %}"
                style="
                  color: #0056cc;
                  font-weight: 600;
                  text-decoration: underline;
                "
                >documentation</a
              >
              for detailed implementation guides and examples.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Grid -->
  <div
    style="
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    "
  >
    <!-- Active Sessions -->
    <div class="card">
      <div class="card-body" style="padding: 24px">
        <div
          style="
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
          "
        >
          <div
            style="
              width: 44px;
              height: 44px;
              background: rgba(0, 122, 255, 0.1);
              border-radius: 12px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <i
              class="fas fa-users"
              style="font-size: 18px; color: var(--color-system-blue)"
            ></i>
          </div>
          <h5 class="text-headline" style="margin: 0">Active Sessions</h5>
        </div>
        <p
          style="
            font-size: 48px;
            font-weight: 700;
            letter-spacing: -2px;
            margin-bottom: 4px;
            color: var(--color-black);
          "
        >
          {{ active_sessions }}
        </p>
        <small class="text-footnote" style="color: var(--color-gray)">
          Out of {{ total_sessions }} total sessions
        </small>
      </div>
    </div>

    <!-- Project URLs -->
    <div class="card">
      <div class="card-body" style="padding: 24px">
        <div
          style="
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
          "
        >
          <div
            style="
              width: 44px;
              height: 44px;
              background: rgba(52, 199, 89, 0.1);
              border-radius: 12px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <i
              class="fas fa-link"
              style="font-size: 18px; color: var(--color-system-green)"
            ></i>
          </div>
          <h5 class="text-headline" style="margin: 0">Project URLs</h5>
        </div>
        <div style="margin-bottom: 12px">
          <small
            class="text-caption"
            style="
              color: var(--color-gray);
              text-transform: uppercase;
              font-weight: 600;
              letter-spacing: 0.5px;
              display: block;
              margin-bottom: 4px;
            "
            >Main URL:</small
          >
          <a
            href="{{ project.main_url }}"
            target="_blank"
            style="
              font-size: 13px;
              color: var(--color-system-blue);
              text-decoration: none;
              word-break: break-all;
            "
          >
            {{ project.main_url }}
          </a>
        </div>
        <div>
          <small
            class="text-caption"
            style="
              color: var(--color-gray);
              text-transform: uppercase;
              font-weight: 600;
              letter-spacing: 0.5px;
              display: block;
              margin-bottom: 4px;
            "
            >Redirect URL:</small
          >
          <span
            style="
              font-size: 13px;
              color: var(--color-charcoal);
              word-break: break-all;
            "
          >
            {{ project.redirect_url }}
          </span>
        </div>
      </div>
    </div>

    <!-- Project Info -->
    <div class="card">
      <div class="card-body" style="padding: 24px">
        <div
          style="
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
          "
        >
          <div
            style="
              width: 44px;
              height: 44px;
              background: rgba(175, 82, 222, 0.1);
              border-radius: 12px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <i
              class="fas fa-info-circle"
              style="font-size: 18px; color: var(--color-system-purple)"
            ></i>
          </div>
          <h5 class="text-headline" style="margin: 0">Project Info</h5>
        </div>
        <div style="margin-bottom: 12px">
          <small
            class="text-caption"
            style="
              color: var(--color-gray);
              text-transform: uppercase;
              font-weight: 600;
              letter-spacing: 0.5px;
              display: block;
              margin-bottom: 4px;
            "
            >Created:</small
          >
          <span
            style="
              font-size: 15px;
              color: var(--color-charcoal);
              font-weight: 400;
            "
          >
            {{ project.created_at|date:"M d, Y" }}
          </span>
        </div>
        <div>
          <small
            class="text-caption"
            style="
              color: var(--color-gray);
              text-transform: uppercase;
              font-weight: 600;
              letter-spacing: 0.5px;
              display: block;
              margin-bottom: 8px;
            "
            >Status:</small
          >
          {% if project.is_verified %}
          <span class="badge bg-success">Verified</span>
          {% else %}
          <span class="badge bg-warning" style="margin-bottom: 4px"
            >Pending Verification</span
          >
          <small
            class="text-footnote"
            style="color: var(--color-gray); display: block"
          >
            (Limited to 10 active logins)
          </small>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="card">
    <div class="card-header">
      <i class="fas fa-tools" style="margin-right: 8px"></i>
      Project Actions
    </div>
    <div class="card-body">
      <div
        style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 12px;
        "
      >
        <a
          href="{% url 'project_ssocall' project.id %}"
          class="btn btn-primary"
          style="padding: 14px 20px"
        >
          <i class="fas fa-sign-in-alt" style="margin-right: 8px"></i>
          Test SSO Login
        </a>
        <button
          class="btn btn-secondary"
          data-bs-toggle="modal"
          data-bs-target="#deleteProjectModal"
          style="
            padding: 14px 20px;
            border: 1px solid var(--color-system-red);
            color: var(--color-system-red);
            background: transparent;
          "
        >
          <i class="fas fa-trash-alt" style="margin-right: 8px"></i>
          Delete Project
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteProjectModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content" style="border-radius: 16px; border: none">
      <div
        class="modal-header"
        style="border-bottom: 0.5px solid var(--color-separator); padding: 24px"
      >
        <h5 class="modal-title text-title-3">Delete Project</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body" style="padding: 24px">
        <p
          class="text-body"
          style="margin: 0; color: var(--color-charcoal); line-height: 1.6"
        >
          Are you sure you want to delete
          <strong style="color: var(--color-black)">{{ project.name }}</strong>?
          This action cannot be undone.
        </p>
      </div>
      <div
        class="modal-footer"
        style="
          border-top: 0.5px solid var(--color-separator);
          padding: 20px 24px;
          gap: 12px;
        "
      >
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <form
          method="POST"
          action="{% url 'delete_project' project.id %}"
          style="display: inline"
        >
          {% csrf_token %}
          <button
            type="submit"
            style="
              background: var(--color-system-red);
              border: none;
              color: white;
              padding: 12px 24px;
              border-radius: 8px;
              font-size: 17px;
              font-weight: 600;
              letter-spacing: -0.4px;
              cursor: pointer;
              transition: all 0.2s var(--ease-out);
            "
          >
            Delete Project
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  function copyProjectId() {
    const projectId = document.getElementById("projectId");
    projectId.select();
    document.execCommand("copy");

    // Show feedback
    const btn = event.target.closest("button");
    const originalHTML = btn.innerHTML;
    btn.innerHTML =
      '<i class="fas fa-check" style="margin-right: 6px;"></i>Copied!';
    setTimeout(() => {
      btn.innerHTML = originalHTML;
    }, 2000);
  }
</script>
{% endblock %}
