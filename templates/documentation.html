{% extends 'base.html' %}
{% load static %}

{% block title %}
Documentation — ITC SSO
{% endblock %}

{% block content %}
<div class="container" style="max-width: 900px">
  <!-- Header -->
  <div style="text-align: center; margin-bottom: 48px">
    <div
      style="
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #007aff 0%, #5856d6 100%);
        border-radius: 20px;
        margin: 0 auto 24px;
        display: flex;
        align-items: center;
        justify-content: center;
      "
    >
      <i class="fas fa-book" style="font-size: 36px; color: white"></i>
    </div>
    <h1 class="text-large-title" style="margin-bottom: 12px">
      Developer Documentation
    </h1>
    <p
      class="text-body"
      style="color: var(--color-gray); max-width: 600px; margin: 0 auto 24px"
    >
      Learn how to integrate ITC SSO into your applications
    </p>
    <a
      href="https://github.com/ITC-Web-Team/itc_sso"
      target="_blank"
      rel="noopener noreferrer"
      class="btn btn-secondary"
    >
      <i class="fab fa-github" style="margin-right: 8px"></i>
      View on GitHub
    </a>
  </div>

  <!-- Overview -->
  <div class="card" style="margin-bottom: 24px">
    <div class="card-header">
      <i class="fas fa-info-circle" style="margin-right: 8px"></i>
      1. Overview
    </div>
    <div class="card-body">
      <p
        class="text-body"
        style="
          color: var(--color-charcoal);
          line-height: 1.6;
          margin-bottom: 24px;
        "
      >
        The ITC SSO service provides a secure, centralized authentication system
        for IITB projects. It enables users to log in once and access multiple
        applications without re-entering credentials.
      </p>

      <div
        style="
          background: var(--color-bg-secondary);
          border-radius: 12px;
          padding: 20px;
          text-align: center;
        "
      >
        <img
          src="https://files.tech-iitb.org/itcssostatic/sso-flow.png"
          alt="SSO Flow Diagram"
          style="
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            border: 0.5px solid var(--color-separator);
          "
        />
        <p
          class="text-footnote"
          style="color: var(--color-gray); margin-top: 12px; margin-bottom: 0"
        >
          SSO Authentication and Data Flow Diagram
        </p>
      </div>
    </div>
  </div>

  <!-- Authentication Flow -->
  <div class="card" style="margin-bottom: 24px">
    <div class="card-header">
      <i class="fas fa-route" style="margin-right: 8px"></i>
      2. Authentication Flow
    </div>
    <div class="card-body">
      <div
        style="
          background: var(--color-bg-secondary);
          border-radius: 12px;
          padding: 24px;
        "
      >
        <ol
          style="
            list-style: none;
            padding: 0;
            margin: 0;
            counter-reset: step-counter;
          "
        >
          <li
            style="
              counter-increment: step-counter;
              margin-bottom: 20px;
              padding-left: 0;
            "
          >
            <div style="display: flex; gap: 16px">
              <div
                style="
                  width: 32px;
                  height: 32px;
                  background: var(--color-system-blue);
                  color: white;
                  border-radius: 8px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-weight: 700;
                  font-size: 15px;
                  flex-shrink: 0;
                "
              >
                1
              </div>
              <div>
                <h4 class="text-headline" style="margin-bottom: 8px">
                  Initial SSO Request
                </h4>
                <ul style="list-style: none; padding: 0; margin: 0">
                  <li
                    class="text-callout"
                    style="color: var(--color-charcoal); margin-bottom: 6px"
                  >
                    • Client redirects to:
                    <code
                      style="
                        background: rgba(0, 0, 0, 0.05);
                        padding: 2px 6px;
                        border-radius: 4px;
                        font-size: 14px;
                      "
                      >sso.tech-iitb.org/project/&lt;project_id&gt;/ssocall/</code
                    >
                  </li>
                  <li class="text-callout" style="color: var(--color-charcoal)">
                    • User is taken to the SSO login page if not already
                    authenticated
                  </li>
                </ul>
              </div>
            </div>
          </li>

          <li
            style="
              counter-increment: step-counter;
              margin-bottom: 20px;
              padding-left: 0;
            "
          >
            <div style="display: flex; gap: 16px">
              <div
                style="
                  width: 32px;
                  height: 32px;
                  background: var(--color-system-blue);
                  color: white;
                  border-radius: 8px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-weight: 700;
                  font-size: 15px;
                  flex-shrink: 0;
                "
              >
                2
              </div>
              <div>
                <h4 class="text-headline" style="margin-bottom: 8px">
                  Authentication Response
                </h4>
                <ul style="list-style: none; padding: 0; margin: 0">
                  <li
                    class="text-callout"
                    style="color: var(--color-charcoal); margin-bottom: 6px"
                  >
                    • After successful login, user is redirected to:
                    <code
                      style="
                        background: rgba(0, 0, 0, 0.05);
                        padding: 2px 6px;
                        border-radius: 4px;
                        font-size: 14px;
                      "
                      >&lt;client_redirect_url&gt;?accessid=&lt;session_key&gt;</code
                    >
                  </li>
                  <li class="text-callout" style="color: var(--color-charcoal)">
                    • The session key is unique for each authentication session
                  </li>
                </ul>
              </div>
            </div>
          </li>

          <li
            style="
              counter-increment: step-counter;
              margin-bottom: 20px;
              padding-left: 0;
            "
          >
            <div style="display: flex; gap: 16px">
              <div
                style="
                  width: 32px;
                  height: 32px;
                  background: var(--color-system-blue);
                  color: white;
                  border-radius: 8px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-weight: 700;
                  font-size: 15px;
                  flex-shrink: 0;
                "
              >
                3
              </div>
              <div>
                <h4 class="text-headline" style="margin-bottom: 8px">
                  User Data Retrieval
                </h4>
                <ul style="list-style: none; padding: 0; margin: 0">
                  <li
                    class="text-callout"
                    style="color: var(--color-charcoal); margin-bottom: 6px"
                  >
                    • Client makes POST request to:
                    <code
                      style="
                        background: rgba(0, 0, 0, 0.05);
                        padding: 2px 6px;
                        border-radius: 4px;
                        font-size: 14px;
                      "
                      >https://sso.tech-iitb.org/project/getuserdata</code
                    >
                  </li>
                  <li class="text-callout" style="color: var(--color-charcoal)">
                    • Request body must include the session key
                  </li>
                </ul>
              </div>
            </div>
          </li>

          <li style="counter-increment: step-counter; padding-left: 0">
            <div style="display: flex; gap: 16px">
              <div
                style="
                  width: 32px;
                  height: 32px;
                  background: var(--color-system-blue);
                  color: white;
                  border-radius: 8px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-weight: 700;
                  font-size: 15px;
                  flex-shrink: 0;
                "
              >
                4
              </div>
              <div>
                <h4 class="text-headline" style="margin-bottom: 8px">
                  Data Response
                </h4>
                <ul style="list-style: none; padding: 0; margin: 0">
                  <li
                    class="text-callout"
                    style="color: var(--color-charcoal); margin-bottom: 6px"
                  >
                    • SSO returns user profile data in JSON format
                  </li>
                  <li class="text-callout" style="color: var(--color-charcoal)">
                    • Includes: name, roll number, department, degree, and
                    passing year
                  </li>
                </ul>
              </div>
            </div>
          </li>
        </ol>
      </div>
    </div>
  </div>

  <!-- Code Examples -->
  <div class="card" style="margin-bottom: 24px">
    <div class="card-header">
      <i class="fas fa-code" style="margin-right: 8px"></i>
      3. Code Examples
    </div>
    <div class="card-body">
      <!-- Python Example -->
      <div style="margin-bottom: 24px">
        <h4
          class="text-headline"
          style="margin-bottom: 12px; color: var(--color-charcoal)"
        >
          Python
        </h4>
        <pre
          style="
            background: var(--color-charcoal);
            color: #e5e5ea;
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.6;
            margin: 0;
          "
        ><code>import requests

# Step 1: Redirect user to SSO
sso_url = f'https://sso.tech-iitb.org/project/{project_id}/ssocall/'

# Step 2: Handle the redirect with session key
def get_user_data(session_key):
    response = requests.post(
        'https://sso.tech-iitb.org/project/getuserdata',
        json={'id': session_key}
    )
    return response.json()

# Response format:
# {
#     "name": "User Name",
#     "roll": "123456789",
#     "department": "Computer Science",
#     "degree": "BTech",
#     "passing_year": "2024"
# }</code></pre>
      </div>

      <!-- JavaScript Example -->
      <div>
        <h4
          class="text-headline"
          style="margin-bottom: 12px; color: var(--color-charcoal)"
        >
          JavaScript
        </h4>
        <pre
          style="
            background: var(--color-charcoal);
            color: #e5e5ea;
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.6;
            margin: 0;
          "
        ><code>// Step 1: Redirect to SSO
function redirectToSSO(projectId) {
    window.location.href = 
        `https://sso.tech-iitb.org/project/${projectId}/ssocall/`;
}

// Step 2: Get user data
async function getUserData(sessionKey) {
    const response = await fetch(
        'https://sso.tech-iitb.org/project/getuserdata',
        {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: sessionKey })
        }
    );
    return response.json();
}</code></pre>
      </div>
    </div>
  </div>

  <!-- Error Handling -->
  <div class="card" style="margin-bottom: 24px">
    <div class="card-header">
      <i class="fas fa-exclamation-triangle" style="margin-right: 8px"></i>
      4. Error Handling
    </div>
    <div class="card-body">
      <div style="display: grid; gap: 12px">
        <div
          style="
            display: flex;
            gap: 12px;
            padding: 16px;
            background: var(--color-bg-secondary);
            border-radius: 8px;
          "
        >
          <span class="badge bg-danger" style="height: fit-content">400</span>
          <div>
            <h5
              class="text-subhead"
              style="font-weight: 600; margin-bottom: 4px"
            >
              Bad Request
            </h5>
            <p class="text-callout" style="color: var(--color-gray); margin: 0">
              Missing or invalid session key
            </p>
          </div>
        </div>
        <div
          style="
            display: flex;
            gap: 12px;
            padding: 16px;
            background: var(--color-bg-secondary);
            border-radius: 8px;
          "
        >
          <span class="badge bg-danger" style="height: fit-content">401</span>
          <div>
            <h5
              class="text-subhead"
              style="font-weight: 600; margin-bottom: 4px"
            >
              Unauthorized
            </h5>
            <p class="text-callout" style="color: var(--color-gray); margin: 0">
              Invalid or expired session
            </p>
          </div>
        </div>
        <div
          style="
            display: flex;
            gap: 12px;
            padding: 16px;
            background: var(--color-bg-secondary);
            border-radius: 8px;
          "
        >
          <span class="badge bg-danger" style="height: fit-content">403</span>
          <div>
            <h5
              class="text-subhead"
              style="font-weight: 600; margin-bottom: 4px"
            >
              Forbidden
            </h5>
            <p class="text-callout" style="color: var(--color-gray); margin: 0">
              Project not authorized
            </p>
          </div>
        </div>
        <div
          style="
            display: flex;
            gap: 12px;
            padding: 16px;
            background: var(--color-bg-secondary);
            border-radius: 8px;
          "
        >
          <span class="badge bg-danger" style="height: fit-content">404</span>
          <div>
            <h5
              class="text-subhead"
              style="font-weight: 600; margin-bottom: 4px"
            >
              Not Found
            </h5>
            <p class="text-callout" style="color: var(--color-gray); margin: 0">
              Invalid endpoint or project ID
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- File Storage -->
  <div class="card" style="margin-bottom: 40px">
    <div class="card-header">
      <i class="fas fa-database" style="margin-right: 8px"></i>
      5. File Storage
    </div>
    <div class="card-body">
      <p
        class="text-body"
        style="
          color: var(--color-charcoal);
          line-height: 1.6;
          margin-bottom: 16px;
        "
      >
        All media files are stored securely using MinIO object storage:
      </p>
      <ul style="list-style: none; padding: 0; margin: 0">
        <li
          style="
            display: flex;
            gap: 12px;
            padding: 12px;
            background: var(--color-bg-secondary);
            border-radius: 8px;
            margin-bottom: 8px;
          "
        >
          <i
            class="fas fa-folder"
            style="color: var(--color-system-blue); margin-top: 2px"
          ></i>
          <div>
            <strong class="text-subhead" style="font-weight: 600"
              >Media Files:</strong
            >
            <span class="text-callout" style="color: var(--color-charcoal)">
              Stored in the media bucket with appropriate access controls</span
            >
          </div>
        </li>
        <li
          style="
            display: flex;
            gap: 12px;
            padding: 12px;
            background: var(--color-bg-secondary);
            border-radius: 8px;
          "
        >
          <i
            class="fas fa-folder"
            style="color: var(--color-system-blue); margin-top: 2px"
          ></i>
          <div>
            <strong class="text-subhead" style="font-weight: 600"
              >Static Files:</strong
            >
            <span class="text-callout" style="color: var(--color-charcoal)">
              Served from a dedicated static bucket</span
            >
          </div>
        </li>
      </ul>
    </div>
  </div>
</div>
{% endblock %}
